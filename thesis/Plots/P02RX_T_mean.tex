\documentclass{standalone}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usetikzlibrary{
    calc,       % <-- to calculate the legend position
    pgfplots.groupplots,
}
\pgfplotsset{
    % use this `compat' level or higher to be able to provide (relative) axis
    % units to `bar width' and `bar shift'
    compat=1.7,
    % define a style wich stores the stuff the both `groupplot' environments
    % have in common
    % (unfortunately there seems to be a bug that prevents also collecting
    %  the stuff from `group style' in another style, see
    %      <https://sourceforge.net/p/pgfplots/bugs/137/>
    %  that is why we have to provide it in both cases separately)
    my axis style/.style={
        % to easier estimate the `width' scale only the axis (box without the
        % ticks and labels)
        scale only axis,
        % now play around with the value so that it fits the `\textwidth'
        % (but of course it has to be smaller than 0.25, because there are
        %  4 plots + 2x ticks + 2x axis labels + 3x axis seperation
        width=\textwidth,
        height=0.22\textwidth,
        enlarge x limits={abs=0.5},
        ybar,
        % to make the individual bars independent of the `width' of the
        % surrounding axis give a `bar width' in axis units
        /pgf/bar width=\BarWidth,
    },
    water/.style={
        fill=blue!30!white,
        draw=blue!50!black,
    },
    co2/.style={
        fill=red!30!white,
        draw=red!50!black,
    },
}

% \degree
\usepackage{gensymb}

\begin{document}
\hrulefill

\begin{tikzpicture}
	% define the values for the horizontal separation of the different axis
	% environments, as well as the width and shift of the bars
	\pgfmathsetlengthmacro{\HorSep}{5mm}
	\pgfmathsetmacro{\BarWidth}{0.3}
	\pgfmathsetmacro{\BarShift}{\BarWidth/2}

    \begin{groupplot}[
        my axis style,
        %
        table/col sep=comma,
        group style={
			group name=plots,
			group size= 1 by 6,
			vertical sep=0pt,
			horizontal sep=\HorSep,
			x descriptions at=edge bottom,
			y descriptions at=edge left,
        },
        ymin=19,
        ymax=49,
        xticklabels from table={P02RX_T_mean.csv}{rack},
        x tick label style={rotate=0,anchor=north},
        xtick=data,
        xtick pos=left,
        legend columns=2,
		grid style={line width=.2pt,draw=gray!20},
		grid=both,
        table/x expr=\coordindex,
        table/y index=1,
        /pgf/bar shift=-\BarShift,
		/pgfplots/error bars/y dir=none|plus|minus|both,
    ]
    \nextgroupplot[
		 title=\textbf{Server Racks Mean Temperatures},
        ylabel={Front\\Top (\degree C)},
        style={align=left},
        legend to name=grouplegend,
        legend entries={
            LBM,
            Exp.,
        },
        ytick distance=5,
    ]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_in_t,y error=sim_T_in_t_err] {P02RX_T_mean.csv};
        \coordinate (top) at (rel axis cs:1,0);% coordinate at top of the first plot
        \addlegendimage{co2,ybar legend}

    \nextgroupplot[ylabel={Front\\Mid (\degree C)},style={align=left},ytick distance=5]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_in_m,y error=sim_T_in_m_err] {P02RX_T_mean.csv};

    \nextgroupplot[ylabel={Front\\Bottom (\degree C)},style={align=left},ytick distance=5]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_in_b,y error=sim_T_in_b_err] {P02RX_T_mean.csv};

    \nextgroupplot[ylabel={Back\\Top (\degree C)},style={align=left},ytick distance=5]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_out_t,y error=sim_T_out_t_err] {P02RX_T_mean.csv};

    \nextgroupplot[ylabel={Back\\Mid (\degree C)},style={align=left},ytick distance=5]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_out_m,y error=sim_T_out_m_err] {P02RX_T_mean.csv};

    \nextgroupplot[xlabel=Racks, ylabel={Back\\Bottom (\degree C)},style={align=left},ytick distance=5]
        \addplot [water] plot [error bars/.cd, y dir=both, y explicit] table [y=sim_T_out_b,y error=sim_T_out_b_err] {P02RX_T_mean.csv};
		\coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot


    \end{groupplot}

    \begin{groupplot}[
        my axis style,
        table/col sep=comma,
        group style={
			group size= 1 by 6,
			vertical sep=0pt,
			horizontal sep=\HorSep,
			x descriptions at=edge bottom,
			y descriptions at=edge left,
        },
        ymin=19,
        ymax=49,
        xtick=\empty,
        axis line style=transparent,
        scaled y ticks=false,
        every axis plot post/.style={co2},
        table/x expr=\coordindex,
        table/y index=2,
        /pgf/bar shift=\BarShift,
    ]
    \nextgroupplot
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_in_t,y error=exp_T_in_t_err] {P02RX_T_mean.csv};

    \nextgroupplot
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_in_m,y error=exp_T_in_m_err] {P02RX_T_mean.csv};

    \nextgroupplot
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_in_b,y error=exp_T_in_b_err] {P02RX_T_mean.csv};

    \nextgroupplot
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_out_t,y error=exp_T_out_t_err] {P02RX_T_mean.csv};

    \nextgroupplot
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_out_m,y error=exp_T_out_m_err] {P02RX_T_mean.csv};

    \nextgroupplot[scaled y ticks=true]
        \addplot plot [error bars/.cd, y dir=both, y explicit] table [y=exp_T_out_b,y error=exp_T_out_b_err] {P02RX_T_mean.csv};

    \end{groupplot}

    \node [anchor=south, xshift=-14mm, yshift=-5mm] at
        ($ (bot|-current bounding box.south)!0.5!(bot|-current bounding box.south) $)
            {\ref{grouplegend}};
\end{tikzpicture}
\end{document}
